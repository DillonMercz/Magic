<head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<div id="cards">
    
</div>


<script>
const currentDate = new Date();
const options = { timeZone: 'America/New_York' };
const [month, day, year] = currentDate.toLocaleDateString('en-US', options)
  .split('/')
  .map((part) => part.padStart(2, '0'));
const formattedDate = `${year}-${month}-${day}`;
console.log(formattedDate);

var requestOptions = {
    method: 'GET',
    redirect: 'follow'
};

fetch(`https://cryptaverse.xyz/predictions/${formattedDate}_predictions.json`, requestOptions)
    .then(response => response.text())
    .then(result => buildParlays(JSON.parse(result)))
    .catch(error => console.log('error', error));

function buildParlays(data) {
  const numGames = data.length;
  const parlays = [];

  // Iterate through games for the first leg
  for (let i = 0; i < numGames - 2; i++) {
    // Iterate through games for the second leg
    for (let j = i + 1; j < numGames - 1; j++) {
      // Iterate through games for the third leg
      for (let k = j + 1; k < numGames; k++) {
        // Build the parlay array and push it to the parlays array
        parlays.push([data[i], data[j], data[k]]);
      }
    }
  }

  //console.log(parlays);
  buildUI(parlays)
}


function buildUI(parlays) {
    console.log(parlays)
    var cardsHTML = "";
    var winners = []
    var losers = []

    for (parlayIndex in parlays) {
        var parlay = parlays[parlayIndex];
           var isLoser = false;

        for (gameIndex in parlay) {
            var gameData = parlay[gameIndex];
            if (gameData.away_team.includes('Hornets') || gameData.away_team.includes('Bucks') || gameData.away_team.includes('Raptors') || gameData.away_team.includes('Hawks')){
                isLoser = true;
                break; // If any game includes one of the specified teams, mark the entire parlay as a loser
            }
        }

        if (isLoser) {
            console.log("found a loser")
            losers.push(parlay);
        } else {
            winners.push(parlay);
        }

        var parlayCard = "";
        //console.log(parlay)
        for (gameIndex in parlay) {
            var gameData = parlay[gameIndex];
            var total1 = gameData.total
            if(gameData.under_over === "UNDER"){
                total1 = total1 +=5
            }
            else if(gameData.under_over === "OVER"){
                total1 = total1 -=5
            }
            parlayCard = parlayCard + `
                <div class="card-body">
                    <h3 id="${gameData.home_team}-stats">${gameData.under_over} ${total1}</h3>
                    <p style="display:inline; color:${gameData.expected_value_colors.away_color} !important">${gameData.away_team}</p> <p style="display:inline;">vs</p> <p style="display:inline; color:${gameData.expected_value_colors.home_color} !important">${gameData.home_team}</p>
                    <br>
                </div>
            `;
        }

        cardsHTML = cardsHTML + `
            <div class="card">
                ${parlayCard}
            </div>
            <br>
            <br>
        `;
    }

    var cards = document.getElementById("cards");
    cards.innerHTML = cards.innerHTML + cardsHTML;
    console.log("winners", winners)
    console.log("losers", losers)
}



</script>