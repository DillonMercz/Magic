<head>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<div id="cards">
    
</div>


<script>
const currentDate = new Date();
const options = { timeZone: 'America/New_York' };
const [month, day, year] = currentDate.toLocaleDateString('en-US', options)
  .split('/')
  .map((part) => part.padStart(2, '0'));
const formattedDate = `${year}-${month}-${day}`;
console.log(formattedDate);

var requestOptions = {
    method: 'GET',
    redirect: 'follow'
};

fetch(`https://cryptaverse.xyz/predictions/${formattedDate}_predictions.json`, requestOptions)
    .then(response => response.text())
    .then(result => buildParlays(JSON.parse(result)))
    .catch(error => console.log('error', error));

function buildParlays(data) {
    data= [
  {
    "home_team": "New York Knicks",
    "away_team": "Charlotte Hornets",
    "winner": 1,
    "under_over": "OVER",
    "winner_confidence": 64.5,
    "un_confidence": 88.9,
    "total": 219,
    "expected_value_colors": {
      "home_color": "RED",
      "away_color": "GREEN"
    }
  },
  {
    "home_team": "Brooklyn Nets",
    "away_team": "Toronto Raptors",
    "winner": 1,
    "under_over": "OVER",
    "winner_confidence": 64.5,
    "un_confidence": 92.4,
    "total": 220,
    "expected_value_colors": {
      "home_color": "RED",
      "away_color": "GREEN"
    }
  },
  {
    "home_team": "Cleveland Cavaliers",
    "away_team": "Atlanta Hawks",
    "winner": 1,
    "under_over": "OVER",
    "winner_confidence": 64.5,
    "un_confidence": 87.3,
    "total": 223.5,
    "expected_value_colors": {
      "home_color": "GREEN",
      "away_color": "RED"
    }
  },
  {
    "home_team": "Miami Heat",
    "away_team": "Milwaukee Bucks",
    "winner": 1,
    "under_over": "UNDER",
    "winner_confidence": 64.5,
    "un_confidence": 94.2,
    "total": 238.5,
    "expected_value_colors": {
      "home_color": "GREEN",
      "away_color": "RED"
    }
  },
  {
    "home_team": "Boston Celtics",
    "away_team": "Chicago Bulls",
    "winner": 1,
    "under_over": "UNDER",
    "winner_confidence": 64.5,
    "un_confidence": 53.0,
    "total": 230.5,
    "expected_value_colors": {
      "home_color": "GREEN",
      "away_color": "RED"
    }
  },
  {
    "home_team": "Minnesota Timberwolves",
    "away_team": "Oklahoma City Thunder",
    "winner": 1,
    "under_over": "UNDER",
    "winner_confidence": 64.5,
    "un_confidence": 69.5,
    "total": 228.5,
    "expected_value_colors": {
      "home_color": "GREEN",
      "away_color": "RED"
    }
  },
  {
    "home_team": "Dallas Mavericks",
    "away_team": "Houston Rockets",
    "winner": 1,
    "under_over": "OVER",
    "winner_confidence": 64.5,
    "un_confidence": 71.8,
    "total": 227.5,
    "expected_value_colors": {
      "home_color": "RED",
      "away_color": "RED"
    }
  },
  {
    "home_team": "Sacramento Kings",
    "away_team": "Golden State Warriors",
    "winner": 1,
    "under_over": "OVER",
    "winner_confidence": 64.5,
    "un_confidence": 58.8,
    "total": 237,
    "expected_value_colors": {
      "home_color": "GREEN",
      "away_color": "RED"
    }
  }
]
  const numGames = data.length;
  const parlays = [];

  // Iterate through games for the first leg
  for (let i = 0; i < numGames - 2; i++) {
    // Iterate through games for the second leg
    for (let j = i + 1; j < numGames - 1; j++) {
      // Iterate through games for the third leg
      for (let k = j + 1; k < numGames; k++) {
        // Build the parlay array and push it to the parlays array
        parlays.push([data[i], data[j], data[k]]);
      }
    }
  }

  //console.log(parlays);
  buildUI(parlays)
}


function buildUI(parlays) {
    console.log(parlays)
    var cardsHTML = "";
    var winners = []
    var losers = []

    for (parlayIndex in parlays) {
        var parlay = parlays[parlayIndex];
           var isLoser = false;

        for (gameIndex in parlay) {
            var gameData = parlay[gameIndex];
            if (gameData.away_team.includes('Hornets') || gameData.away_team.includes('Bucks')){
                isLoser = true;
                break; // If any game includes one of the specified teams, mark the entire parlay as a loser
            }
        }

        if (isLoser) {
            console.log("found a loser")
            losers.push(parlay);
        } else {
            winners.push(parlay);
        }

        var parlayCard = "";
        //console.log(parlay)
        for (gameIndex in parlay) {
            var gameData = parlay[gameIndex];
            var total1 = gameData.total
            if(gameData.under_over === "UNDER"){
                total1 = total1 +=5
            }
            else if(gameData.under_over === "OVER"){
                total1 = total1 -=5
            }
            parlayCard = parlayCard + `
                <div class="card-body">
                    <h3 id="${gameData.home_team}-stats">${gameData.under_over} ${total1}</h3>
                    <p style="display:inline; color:${gameData.expected_value_colors.away_color} !important">${gameData.away_team}</p> <p style="display:inline;">vs</p> <p style="display:inline; color:${gameData.expected_value_colors.home_color} !important">${gameData.home_team}</p>
                    <br>
                </div>
            `;
        }

        cardsHTML = cardsHTML + `
            <div class="card">
                ${parlayCard}
            </div>
            <br>
            <br>
        `;
    }

    var cards = document.getElementById("cards");
    cards.innerHTML = cards.innerHTML + cardsHTML;
    console.log("winners", winners)
    console.log("losers", losers)
}



</script>